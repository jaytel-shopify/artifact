"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[58],{3058:(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var l=a(8045),r=a(5177),i=a(3713),n=a(1266);function s(e){let{url:t,metadata:a,fitMode:s=!1}=e,o=(0,r.useMemo)(()=>(function(e){try{let t=new URL(e);if("http:"===t.protocol||"https:"===t.protocol)return t.toString();return null}catch(e){return null}})(t),[t]),[c,d]=(0,r.useState)(!1),u=(0,r.useRef)(null),[h,x]=(0,r.useState)(1),[f,m]=(0,r.useState)(()=>(0,n.OG)(n.di).height),v=(0,r.useMemo)(()=>{if("number"==typeof(null==a?void 0:a.width)&&"number"==typeof(null==a?void 0:a.height))return{width:a.width,height:a.height};let e=null==a?void 0:a.viewport;return e&&n.y8[e]?(0,n.OG)(e):(0,n.OG)(n.di)},[null==a?void 0:a.height,null==a?void 0:a.width,null==a?void 0:a.viewport]),p=(0,r.useMemo)(()=>{try{return new URL(o||"").hostname}catch(e){return o}},[o]);return((0,r.useLayoutEffect)(()=>{let e=u.current;if(!e)return;let t=()=>{if(s){let t=e.clientWidth,a=window.innerHeight-194;if(!t||!v.width||!v.height)return;let l=Math.min(t/v.width,a/v.height);x(l),m(v.height*l)}else{let t=e.clientWidth;if(!t||!v.width)return;let a=t/v.width;x(a),m(v.height*a)}};t();let a=null;return"undefined"!=typeof ResizeObserver?(a=new ResizeObserver(()=>t())).observe(e):window.addEventListener("resize",t),()=>{null==a||a.disconnect(),window.removeEventListener("resize",t)}},[v.height,v.width,s]),o)?c?(0,l.jsx)("div",{ref:u,className:"w-full flex items-start",children:(0,l.jsxs)(i.Zp,{className:"max-w-xl w-full bg-white/80 backdrop-blur border border-white/20 shadow-2xl",children:[(0,l.jsx)(i.aR,{children:(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsx)("div",{className:"w-10 h-10 flex-shrink-0 bg-gray-200 rounded flex items-center justify-center",children:(0,l.jsx)("svg",{className:"w-6 h-6 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),(0,l.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,l.jsx)(i.ZB,{className:"text-gray-900 truncate text-base",children:p}),(0,l.jsx)(i.BT,{className:"text-gray-600 truncate mt-1",children:o}),c&&(0,l.jsx)("div",{className:"mt-2 text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded",children:"⚠️ This site cannot be embedded. Click below to open."})]})]})}),(0,l.jsx)(i.wL,{className:"pt-0",children:(0,l.jsx)("a",{href:o,target:"_blank",rel:"noreferrer noopener",className:"text-blue-600 hover:underline text-sm font-medium",children:"Open in new tab →"})})]})}):(0,l.jsx)("div",{ref:u,className:"w-full flex justify-center",style:{position:"relative",height:"".concat(f,"px"),overflow:s?"visible":"hidden"},children:(0,l.jsx)("div",{className:"shadow-2xl border border-white/10",style:{position:s?"relative":"absolute",top:s?void 0:0,left:s?void 0:0,width:"".concat(v.width,"px"),height:"".concat(v.height,"px"),transform:"scale(".concat(h,")"),transformOrigin:s?"top center":"top left",pointerEvents:"auto"},children:(0,l.jsx)("iframe",{src:o,width:v.width,height:v.height,className:"w-full h-full",allow:"clipboard-write; fullscreen; autoplay; encrypted-media; picture-in-picture",referrerPolicy:"no-referrer-when-downgrade",style:{border:0},onError:()=>d(!0)})})}):(0,l.jsx)("div",{className:"p-4 text-sm text-red-600",children:"Invalid URL"})}var o=a(2989);function c(e){let{src:t,alt:a,fitMode:i=!1}=e,n=(0,r.useMemo)(()=>(function(e){try{return new URL(e).hostname.includes("quick.shopify.io")}catch(e){return!1}})(t),[t]),s=i?"":"w-full h-auto",c=i?{maxWidth:"100%",maxHeight:"calc(100vh - 194px)",width:"auto",height:"auto",objectFit:"contain"}:void 0;return n?(0,l.jsx)(o.default,{src:t,alt:a||"",width:2e3,height:1500,className:s,style:c}):(0,l.jsx)("img",{src:t,alt:a||"",className:s,style:c})}function d(e){let{src:t,poster:a,metadata:i,fitMode:n=!1}=e,s=(0,r.useRef)(null),o=!(null==i?void 0:i.hideUI),c=(null==i?void 0:i.loop)||!1,d=(null==i?void 0:i.muted)!==!1;return(0,r.useEffect)(()=>{let e=s.current;if(!e||!c)return;let t=async()=>{try{await e.play()}catch(e){console.log("Auto-play blocked for looping video:",e)}};return e.readyState>=1?t():e.addEventListener("loadedmetadata",t,{once:!0}),()=>{e.removeEventListener("loadedmetadata",t)}},[c,t]),(0,l.jsx)("video",{ref:s,src:t,poster:a,controls:o,loop:c,muted:d,playsInline:!0,className:n?"cursor-pointer":"w-full h-auto cursor-pointer",style:n?{maxWidth:"100%",maxHeight:"calc(100vh - 194px)",width:"auto",height:"auto",objectFit:"contain"}:void 0,onClick:()=>{if(o)return;let e=s.current;e&&(e.paused?e.play():e.pause())}})}var u=a(3173),h=a(9155),x=a(9966),f=a(9208),m=a(7651);function v(e){let{title:t,artifactId:a,onUpdate:i,className:n="",artifactType:s,sourceUrl:o}=e,[c,d]=(0,r.useState)(!1),[v,p]=(0,r.useState)(t),[g,w]=(0,r.useState)(!1),y=(0,r.useRef)(null);(0,r.useEffect)(()=>{p(t)},[t]),(0,r.useEffect)(()=>{c&&y.current&&(y.current.focus(),y.current.select())},[c]);let j=(0,r.useCallback)(()=>{d(!0)},[]),b=(0,r.useCallback)(async()=>{if(v.trim()===t.trim())return void d(!1);w(!0);try{await i(v.trim()||"Untitled"),d(!1),v.trim()!==t.trim()&&m.oR.success("Artifact title updated")}catch(e){m.oR.error("Failed to update title. Please try again."),console.error("Failed to update artifact title:",e),p(t)}finally{w(!1)}},[v,t,i]),N=(0,r.useCallback)(()=>{p(t),d(!1)},[t]),k=(0,r.useCallback)(e=>{"Enter"===e.key?(e.preventDefault(),b()):"Escape"===e.key&&(e.preventDefault(),N())},[b,N]),C=(0,r.useCallback)(()=>{b()},[b]),R="url"===s;return c?(0,l.jsx)("div",{className:"text-center ".concat(n),children:(0,l.jsx)(u.p,{ref:y,type:"text",value:v,onChange:e=>p(e.target.value),onKeyDown:k,onBlur:C,disabled:g,placeholder:"Untitled",className:"h-6 text-xs text-center bg-transparent border-0 focus:bg-white focus:text-gray-800 focus:border-gray-300 px-1 py-0.5 min-w-0 w-full max-w-full",style:{fontSize:"14px",lineHeight:"1.2",minWidth:"60px",maxWidth:"440px"}})}):(0,l.jsxs)("div",{className:"flex items-center justify-center gap-2 ".concat(n),children:[R&&(0,l.jsx)(x.A,{className:"h-4 w-4 text-gray-400 flex-shrink-0"}),(0,l.jsx)("div",{className:"cursor-pointer hover:bg-white/5 rounded-md px-2 py-1 transition-colors duration-200 flex-1 min-w-0",onDoubleClick:j,title:"Double-click to edit",children:(0,l.jsx)("div",{className:"text-xs text-gray-400 truncate select-none",style:{fontSize:"14px",lineHeight:"1.2"},children:v||"Untitled"})}),R&&o&&(0,l.jsx)(h.$,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 flex-shrink-0 text-gray-500 hover:text-gray-300 hover:bg-white/10",onClick:e=>{e.stopPropagation(),window.open(o,"_blank","noopener,noreferrer")},"aria-label":"Open in new tab",children:(0,l.jsx)(f.A,{className:"h-3.5 w-3.5"})})]})}var p=a(6436),g=a(6655),w=a(4922),y=a(5078),j=a(5376),b=a(6174),N=a(3816),k=a(1003),C=a(9317),R=a(4326),E=a(557),S=a(4513);function L(e){let{artifact:t,width:a,columnHeight:r,isGlobalDragActive:i,activeArtifactId:n,fitMode:s=!1,children:o}=e,{attributes:c,listeners:d,setNodeRef:u,transform:h,transition:x,isDragging:f}=(0,C.gl)({id:t.id}),m=null!==h,v=f&&i;(f||i)&&console.log("[Artifact ".concat(t.id.slice(0,8),"] isDragging: ").concat(f,", isGlobalDragActive: ").concat(i,", shouldDim: ").concat(v));let p={width:a,minHeight:"100%",scrollSnapAlign:"start",transition:i&&m?x:void 0,transform:E.Ks.Transform.toString(h),cursor:f?"grabbing":"grab",touchAction:"manipulation"};return(0,l.jsx)(S.P.div,{ref:u,style:p,"data-artifact-id":t.id,className:"inline-flex flex-col align-top shrink-0 h-full",layout:!i,transition:{layout:{type:"spring",bounce:.15,duration:.4}},...c,...d,children:(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)("div",{className:s?"h-full flex flex-col":"overflow-y-auto",style:{maxHeight:s?void 0:r?"".concat(r,"px"):void 0},children:(0,l.jsxs)("div",{className:"overflow-hidden dim-overlay-parent relative ".concat(s?"flex-1 flex flex-col":""),children:[o,v&&(0,l.jsx)("style",{dangerouslySetInnerHTML:{__html:'\n                  [data-artifact-id="'.concat(t.id,'"] [data-artifact-overlay-container="true"]::after {\n                    content: "";\n                    position: absolute;\n                    inset: 0;\n                    background: black;\n                    opacity: 0.9;\n                    pointer-events: none;\n                    z-index: 10;\n                  }\n                ')}})]})})})})}function A(e){let{artifact:t,maxHeight:a}=e;return(0,l.jsx)("div",{className:"pointer-events-none overflow-y-auto",style:{maxHeight:a?"".concat(a,"px"):void 0},children:(0,l.jsx)("div",{className:"overflow-hidden",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"mb-2",children:(0,l.jsx)("div",{className:"text-center",children:(0,l.jsx)("div",{className:"text-xs text-gray-400 truncate select-none px-2 py-1",style:{fontSize:"14px",lineHeight:"1.2",maxWidth:"440px",margin:"0 auto"},children:t.name||"Untitled"})})}),(0,l.jsx)("div",{children:(0,l.jsx)(U,{artifact:t})})]})})})}function U(e){let{artifact:t}=e;return"image"===t.type?(0,l.jsx)(c,{src:t.source_url,alt:""}):"url"===t.type?(0,l.jsx)(s,{url:t.source_url}):"video"===t.type?(0,l.jsx)(d,{src:t.source_url}):(0,l.jsx)("div",{className:"text-sm text-white/70",children:"Unsupported"})}function M(e){let{columns:t,artifacts:a,onReorder:i,onUpdateArtifact:n,onDeleteArtifact:s,isReadOnly:o=!1,fitMode:c=!1}=e,[d,u]=(0,r.useState)(a),[h,x]=(0,r.useState)(null),[f,E]=(0,r.useState)(!1),S=(0,r.useRef)(null);(0,r.useEffect)(()=>{u(a)},[a]);let U=(0,k.FR)((0,k.MS)(k.AN,{activationConstraint:{distance:6},...o?{activationConstraint:{distance:999999}}:{}})),[M,D]=(0,r.useState)(!1),[I,z]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=window.matchMedia("(any-pointer: coarse)"),t=()=>D(e.matches);t(),e.addEventListener("change",t);let a=()=>{D(!1),window.removeEventListener("wheel",a)};return window.addEventListener("wheel",a,{passive:!0}),()=>{e.removeEventListener("change",t),window.removeEventListener("wheel",a)}},[]),(0,r.useLayoutEffect)(()=>{let e=S.current;if(!e)return;let t=()=>z(e.clientHeight);t();let a=()=>t(),l=null;return"undefined"!=typeof ResizeObserver?(l=new ResizeObserver(a)).observe(e):window.addEventListener("resize",a),()=>{null==l||l.disconnect(),window.removeEventListener("resize",a)}},[d.length]);let H=(0,r.useMemo)(()=>"calc((100% - ".concat((t-1)*32,"px) / ").concat(t,")"),[t,32]),B=(0,r.useCallback)(e=>{let{active:t,over:a}=e;console.log("[Canvas] handleDragEnd called - clearing state immediately"),x(null),E(!1),a&&t.id!==a.id&&u(e=>{let l=e.findIndex(e=>e.id===t.id),r=e.findIndex(e=>e.id===a.id);if(-1===l||-1===r)return e;let n=(0,C.be)(e,l,r);return null==i||i(n),n})},[i]),F=(0,r.useCallback)(e=>{console.log("[Canvas] handleDragStart called"),x(e.active.id),E(!0)},[]),O=(0,r.useCallback)(e=>{let t=S.current,a=e.active.rect.current.translated;if(!t||!a)return;let l=t.getBoundingClientRect();a.right>l.right-120?t.scrollBy({left:28,behavior:"auto"}):a.left<l.left+120&&t.scrollBy({left:-28,behavior:"auto"})},[]),W=(0,r.useCallback)(e=>{let{artifact:t,children:a}=e,r="video"===t.type,i=t.metadata;if(o)return(0,l.jsx)("div",{className:"group relative",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{"data-artifact-title-id":t.id,children:(0,l.jsx)("div",{className:"mb-6 text-white/80 text-sm font-medium text-center",children:t.name})}),(0,l.jsx)("div",{className:"relative","data-artifact-overlay-container":"true",children:a})]})});let c=async()=>{if(!n)return;let e={...t.metadata,hideUI:!(null==i?void 0:i.hideUI)};try{await n(t.id,{metadata:e}),m.oR.success((null==i?void 0:i.hideUI)?"Video controls enabled":"Video controls hidden")}catch(e){m.oR.error("Failed to update video settings")}},d=async()=>{if(!n)return;let e={...t.metadata,loop:!(null==i?void 0:i.loop)};try{await n(t.id,{metadata:e}),m.oR.success((null==i?void 0:i.loop)?"Video loop disabled":"Video loop enabled")}catch(e){m.oR.error("Failed to update video settings")}},u=async()=>{if(!n)return;let e=(null==i?void 0:i.muted)!==!1,a={...t.metadata,muted:!e};try{await n(t.id,{metadata:a}),m.oR.success(e?"Video unmuted":"Video muted")}catch(e){m.oR.error("Failed to update video settings")}};return(0,l.jsxs)(p.tz,{children:[(0,l.jsx)(p.Rc,{asChild:!0,children:(0,l.jsx)("div",{className:"group relative",children:(0,l.jsxs)("div",{className:"space-y-4 h-full flex flex-col",children:[(0,l.jsx)("div",{"data-artifact-title-id":t.id,children:(0,l.jsx)(v,{title:t.name,artifactId:t.id,onUpdate:e=>{var a;return null!=(a=null==n?void 0:n(t.id,{name:e}))?a:Promise.resolve()},artifactType:t.type,sourceUrl:t.source_url,className:"mb-6"})}),(0,l.jsx)("div",{className:"relative flex-1 flex items-start justify-center","data-artifact-overlay-container":"true",children:a})]})})}),(0,l.jsxs)(p.Ip,{children:[r&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(p.kt,{onClick:c,className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"w-4 h-4 flex items-center justify-center",children:(null==i?void 0:i.hideUI)?null:(0,l.jsx)(g.A,{className:"w-3 h-3"})}),(null==i?void 0:i.hideUI)?(0,l.jsx)(y.A,{className:"w-4 h-4"}):(0,l.jsx)(w.A,{className:"w-4 h-4"}),"Show Controls"]}),(0,l.jsxs)(p.kt,{onClick:d,className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"w-4 h-4 flex items-center justify-center",children:(null==i?void 0:i.loop)?(0,l.jsx)(g.A,{className:"w-3 h-3"}):null}),(0,l.jsx)(j.A,{className:"w-4 h-4"}),"Loop Video"]}),(0,l.jsxs)(p.kt,{onClick:u,className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"w-4 h-4 flex items-center justify-center",children:(null==i?void 0:i.muted)===!1?(0,l.jsx)(g.A,{className:"w-3 h-3"}):null}),(null==i?void 0:i.muted)!==!1?(0,l.jsx)(b.A,{className:"w-4 h-4"}):(0,l.jsx)(N.A,{className:"w-4 h-4"}),"Audio On"]}),(0,l.jsx)(p.kt,{disabled:!0,className:"h-px bg-border p-0 m-1"})]}),(0,l.jsx)(p.kt,{variant:"destructive",onClick:async()=>{try{await (null==s?void 0:s(t.id)),m.oR.success('"'.concat(t.name,'" deleted successfully'))}catch(e){m.oR.error("Failed to delete artifact. Please try again."),console.error("Failed to delete artifact:",e)}},children:"Delete"})]})]})},[n,s,o]);return 0===d.length?(0,l.jsx)("div",{className:"h-full flex items-center justify-center text-white/60",children:"No artifacts yet. Add one to get started."}):(0,l.jsxs)(k.Mp,{sensors:U,collisionDetection:k.fp,onDragStart:F,onDragMove:O,onDragEnd:B,children:[(0,l.jsx)("div",{className:"h-full",children:(0,l.jsx)(R.o,{children:(0,l.jsx)("div",{ref:S,className:"w-full h-full overflow-x-auto overflow-y-hidden flex ".concat(c?"justify-center items-start":"items-stretch"," ").concat(M?"":"hide-scrollbar"),style:{gap:"".concat(32,"px"),scrollSnapType:f?"none":"x mandatory",scrollPaddingInline:"".concat(32,"px"),paddingInline:"".concat(32,"px"),paddingBottom:c?"64px":void 0},children:(0,l.jsx)(C.gB,{items:d.map(e=>e.id),strategy:C.m$,children:d.map(e=>(0,l.jsx)(L,{artifact:e,width:H,columnHeight:null!=I?I:void 0,isGlobalDragActive:f,activeArtifactId:h,fitMode:c,children:(0,l.jsx)(W,{artifact:e,children:(0,l.jsx)(_,{artifact:e,fitMode:c})})},e.id))})})})}),(0,l.jsx)(k.Hd,{children:h?(0,l.jsx)(A,{artifact:d.find(e=>e.id===h),maxHeight:null!=I?I:void 0}):null})]})}function _(e){let{artifact:t,fitMode:a=!1}=e;return"image"===t.type?(0,l.jsx)(c,{src:t.source_url,alt:"",fitMode:a}):"url"===t.type?(0,l.jsx)(s,{url:t.source_url,metadata:t.metadata,fitMode:a}):"video"===t.type?(0,l.jsx)(d,{src:t.source_url,metadata:t.metadata,fitMode:a}):(0,l.jsxs)("div",{className:"h-full flex items-center justify-center text-sm text-gray-500",children:["Unsupported type: ",t.type]})}},3713:(e,t,a)=>{a.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>s,Zp:()=>i,aR:()=>n,wL:()=>d});var l=a(8045);a(5177);var r=a(6816);function i(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function n(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function s(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...a})}function o(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...a})}function c(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",t),...a})}function d(e){let{className:t,...a}=e;return(0,l.jsx)("div",{"data-slot":"card-footer",className:(0,r.cn)("flex items-center px-6 [.border-t]:pt-6",t),...a})}}}]);
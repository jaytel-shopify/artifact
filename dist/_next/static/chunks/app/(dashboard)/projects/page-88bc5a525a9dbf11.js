(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[709],{2388:(e,r,l)=>{"use strict";l.r(r),l.d(r,{default:()=>_});var o=l(8045),s=l(3842),t=l(5177),n=l(5070),a=l(6198),c=l(5993),i=l(7023),d=l(9155),m=l(3173),h=l(6436),u=l(6796);let j=(0,l(4805).A)("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);var x=l(50),p=l(8533),f=l(9005),v=l(5091);function g(e){let{folder:r,projectCount:l,onRename:s,onManageAccess:t,onDelete:a}=e,c=(0,n.useRouter)();function i(e,r){e.stopPropagation(),r()}return(0,o.jsxs)(h.tz,{children:[(0,o.jsx)(h.Rc,{asChild:!0,children:(0,o.jsxs)("div",{onClick:function(){c.push("/folder?id=".concat(r.id))},onMouseEnter:function(){c.prefetch("/folder?id=".concat(r.id))},className:"group relative bg-card hover:bg-accent/50 border rounded-lg p-6 cursor-pointer transition-all hover:shadow-md",children:[(0,o.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,o.jsx)("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center",children:(0,o.jsx)(f.A,{className:"h-6 w-6 text-primary"})}),(0,o.jsxs)(u.rI,{children:[(0,o.jsx)(u.ty,{asChild:!0,onClick:e=>e.stopPropagation(),children:(0,o.jsx)(d.$,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,o.jsx)(v.A,{className:"h-4 w-4"})})}),(0,o.jsxs)(u.SQ,{align:"end",children:[(0,o.jsx)(u._2,{onClick:e=>i(e,()=>s(r)),children:"Rename Folder"}),(0,o.jsx)(u._2,{onClick:e=>i(e,()=>t(r)),children:"Manage Access"}),(0,o.jsx)(u._2,{variant:"destructive",onClick:e=>i(e,()=>a(r)),children:"Delete Folder"})]})]})]}),(0,o.jsxs)("div",{className:"space-y-1",children:[(0,o.jsx)("h3",{className:"font-semibold text-lg truncate",children:r.name}),(0,o.jsxs)("p",{className:"text-sm text-muted-foreground",children:[l," ",1===l?"project":"projects"]})]})]})}),(0,o.jsxs)(h.Ip,{children:[(0,o.jsx)(h.kt,{onClick:()=>s(r),children:"Rename Folder"}),(0,o.jsx)(h.kt,{onClick:()=>t(r),children:"Manage Access"}),(0,o.jsx)(h.kt,{variant:"destructive",onClick:()=>a(r),children:"Delete Folder"})]})]})}var y=l(9444),C=l(6611),N=l(2402),k=l(8227);function F(e){let{folders:r,currentFolderId:l,onMoveToFolder:s,onRemoveFromFolder:t}=e,n=r.filter(e=>e.id!==l);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(h.Fj,{children:[(0,o.jsxs)(h.Pd,{className:"flex items-center gap-2",children:[(0,o.jsx)(f.A,{className:"h-4 w-4"}),"Move to Folder"]}),(0,o.jsx)(h.es,{children:n.length>0?n.map(e=>(0,o.jsx)(h.kt,{onClick:()=>s(e.id),children:e.name},e.id)):(0,o.jsx)(h.kt,{disabled:!0,children:l?"No other folders":"No folders yet"})})]}),l&&(0,o.jsxs)(h.kt,{onClick:t,className:"flex items-center gap-2",children:[(0,o.jsx)(k.A,{className:"h-4 w-4"}),"Remove from Folder"]})]})}var w=l(7651),R=l(3283),b=l(786);async function P(e){let[r,l]=await Promise.all([(0,R.JQ)(e),(0,b.getUserFolders)(e||"")]);return{projects:await Promise.all(r.map(async e=>{let r=await (0,R.yg)(e.id);return{...e,coverArtifacts:r.slice(0,3)}})),folders:await Promise.all(l.map(async e=>{let r=await (0,b.KO)(e.id);return{...e,projectCount:r}}))}}function _(){let e=(0,n.useRouter)(),{user:r}=(0,a.A)(),{data:l,isLoading:f,error:v,mutate:k}=(0,s.Ay)(r?"projects-folders-".concat(r.email):null,()=>r?P(r.email):{projects:[],folders:[]},{revalidateOnFocus:!1,dedupingInterval:3e4,refreshInterval:6e4}),_=(null==l?void 0:l.projects)||[],A=(null==l?void 0:l.folders)||[],[M,S]=(0,t.useState)(A);(0,t.useEffect)(()=>{S(A)},[A]);let[E,O]=(0,t.useState)(!1),[D,I]=(0,t.useState)(null),[$,L]=(0,t.useState)(null),[T,z]=(0,t.useState)(null),[H,K]=(0,t.useState)(!1),[Q,V]=(0,t.useState)(null),[Z,q]=(0,t.useState)(!1),[G,J]=(0,t.useState)(null),[U,B]=(0,t.useState)(""),W=(0,t.useMemo)(()=>_.filter(e=>!e.folder_id),[_]);function X(){e.push("/projects/new")}async function Y(e){if(null==r?void 0:r.email)try{let l=await (0,b.vV)({name:e,creator_id:r.email});S(e=>[...e,{...l,projectCount:0}]),w.oR.success('Folder "'.concat(e,'" created'))}catch(e){throw console.error("Failed to create folder:",e),w.oR.error("Failed to create folder"),e}}async function ee(e){if(D)try{await (0,b.updateFolder)(D.id,{name:e}),S(r=>r.map(r=>r.id===D.id?{...r,name:e}:r)),w.oR.success("Folder renamed"),I(null)}catch(e){throw console.error("Failed to rename folder:",e),w.oR.error("Failed to rename folder"),e}}async function er(){if($)try{await (0,b.sE)($.id),S(e=>e.filter(e=>e.id!==$.id)),k(),w.oR.success('Folder "'.concat($.name,'" deleted')),L(null)}catch(e){throw console.error("Failed to delete folder:",e),w.oR.error("Failed to delete folder"),e}}async function el(e,r){try{await (0,b.moveProjectToFolder)(e.id,r),S(l=>l.map(l=>l.id===r?{...l,projectCount:l.projectCount+1}:e.folder_id&&l.id===e.folder_id?{...l,projectCount:Math.max(0,l.projectCount-1)}:l)),k();let l=A.find(e=>e.id===r);w.oR.success("Moved to ".concat((null==l?void 0:l.name)||"folder"))}catch(e){console.error("Failed to move project:",e),w.oR.error("Failed to move project")}}async function eo(e){try{await (0,b.removeProjectFromFolder)(e.id),e.folder_id&&S(r=>r.map(r=>r.id===e.folder_id?{...r,projectCount:Math.max(0,r.projectCount-1)}:r)),k(),w.oR.success("Removed from folder")}catch(e){console.error("Failed to remove from folder:",e),w.oR.error("Failed to remove from folder")}}function es(e){J(e),B(e.name)}async function et(){if(Q){K(!0);try{await (0,R.xx)(Q.id),k(),w.oR.success('Project "'.concat(Q.name,'" deleted successfully')),V(null)}catch(e){w.oR.error("Failed to delete project. Please try again."),console.error("Error deleting project:",e)}finally{K(!1)}}}async function en(){if(G&&U.trim()){q(!0);try{await (0,R.updateProject)(G.id,{name:U.trim()}),k(),w.oR.success('Project renamed to "'.concat(U.trim(),'"')),J(null),B("")}catch(e){w.oR.error("Failed to rename project. Please try again."),console.error("Error renaming project:",e)}finally{q(!1)}}}return f?null:(0,o.jsx)(p.A,{isLoading:!1,children:(0,o.jsxs)("div",{className:"h-screen flex flex-col bg-[var(--color-background-primary)] text-[var(--color-text-primary)]",children:[(0,o.jsx)("div",{className:"bg-[var(--color-background-primary)] border-b border-[var(--color-border-primary)]",style:{height:"var(--header-height)"},children:(0,o.jsxs)("div",{className:"flex items-center justify-between h-full px-8",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("img",{src:"/favicons/icon-256.png",alt:"Artifact",className:"w-8 h-8",style:{imageRendering:"crisp-edges"}}),(0,o.jsx)("h1",{className:"text-lg font-semibold text-[var(--color-text-primary)]",children:"Artifact"})]}),(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsxs)(d.$,{variant:"outline",className:"gap-2",onClick:()=>O(!0),children:[(0,o.jsx)(j,{className:"h-4 w-4"}),"New Folder"]}),(0,o.jsx)(d.$,{className:"gap-2",onClick:X,children:"New Project"})]})]})}),(0,o.jsx)("main",{className:"flex-1 overflow-auto",children:(0,o.jsxs)("div",{className:"max-w-7xl mx-auto p-6 space-y-8",children:[v&&(0,o.jsx)("p",{className:"text-red-600",children:String(v)}),M.length>0&&(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)("h2",{className:"text-lg font-semibold",children:"Folders"}),(0,o.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:M.map(e=>(0,o.jsx)(g,{folder:e,projectCount:e.projectCount,onRename:e=>I(e),onManageAccess:e=>z(e),onDelete:e=>L(e)},e.id))})]}),W.length>0&&(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsx)("h2",{className:"text-lg font-semibold",children:"Projects"}),(0,o.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:W.map(r=>(0,o.jsxs)(h.tz,{children:[(0,o.jsx)(h.Rc,{asChild:!0,children:(0,o.jsx)("div",{children:(0,o.jsx)(x.A,{project:r,onClick:()=>{e.push("/p?token=".concat(r.share_token))},onHover:()=>{e.prefetch("/p?token=".concat(r.share_token))},onDelete:()=>{V(r)},menuItems:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u._2,{onClick:()=>es(r),children:"Rename Project"}),M.length>0&&(0,o.jsx)(o.Fragment,{children:M.map(e=>(0,o.jsxs)(u._2,{onClick:()=>el(r,e.id),children:["Move to ",e.name]},e.id))}),(0,o.jsx)(u._2,{variant:"destructive",onClick:()=>{V(r)},children:"Delete Project"})]})})})}),(0,o.jsxs)(h.Ip,{children:[(0,o.jsx)(h.kt,{onClick:()=>es(r),children:"Rename Project"}),(0,o.jsx)(F,{folders:M,currentFolderId:r.folder_id,onMoveToFolder:e=>el(r,e),onRemoveFromFolder:()=>eo(r)}),(0,o.jsx)(h.kt,{variant:"destructive",onClick:()=>{V(r)},children:"Delete Project"})]})]},r.id))})]}),!f&&0===M.length&&0===W.length&&(0,o.jsxs)("div",{className:"text-center py-12",children:[(0,o.jsx)("p",{className:"text-muted-foreground mb-4",children:"No projects or folders yet"}),(0,o.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,o.jsx)(d.$,{variant:"outline",onClick:()=>O(!0),children:"Create Folder"}),(0,o.jsx)(d.$,{onClick:X,children:"Create Project"})]})]}),(0,o.jsx)(c.Lt,{open:!!Q,onOpenChange:e=>!e&&V(null),children:(0,o.jsxs)(c.EO,{children:[(0,o.jsxs)(c.wd,{children:[(0,o.jsx)(c.r7,{children:"Delete Project"}),(0,o.jsxs)(c.$v,{children:["Are you sure you want to delete “",null==Q?void 0:Q.name,"”? This will permanently delete the project and all its pages and artifacts. This action cannot be undone."]})]}),(0,o.jsxs)(c.ck,{children:[(0,o.jsx)(c.Zr,{children:"Cancel"}),(0,o.jsx)(c.Rx,{className:(0,d.r)({variant:"destructive"}),onClick:et,disabled:H,children:H?"Deleting...":"Delete"})]})]})}),(0,o.jsx)(i.lG,{open:!!G,onOpenChange:e=>!e&&J(null),children:(0,o.jsxs)(i.Cf,{children:[(0,o.jsxs)(i.c7,{children:[(0,o.jsx)(i.L3,{children:"Rename Project"}),(0,o.jsxs)(i.rr,{children:["Enter a new name for “",null==G?void 0:G.name,"”"]})]}),(0,o.jsx)("div",{className:"py-4",children:(0,o.jsx)(m.p,{value:U,onChange:e=>B(e.target.value),placeholder:"Project name",onKeyDown:e=>{"Enter"===e.key&&U.trim()&&en()},autoFocus:!0})}),(0,o.jsxs)(i.Es,{children:[(0,o.jsx)(d.$,{variant:"outline",onClick:()=>J(null),children:"Cancel"}),(0,o.jsx)(d.$,{onClick:en,disabled:Z||!U.trim(),children:Z?"Renaming...":"Rename"})]})]})}),(0,o.jsx)(y.A,{isOpen:E,onClose:()=>O(!1),onSubmit:Y,mode:"create"}),(0,o.jsx)(y.A,{isOpen:!!D,onClose:()=>I(null),onSubmit:ee,mode:"rename",initialName:(null==D?void 0:D.name)||""}),(0,o.jsx)(N.A,{isOpen:!!T,onClose:()=>z(null),folderId:(null==T?void 0:T.id)||"",folderName:(null==T?void 0:T.name)||"",creatorEmail:(null==T?void 0:T.creator_id)||""}),(0,o.jsx)(C.A,{isOpen:!!$,onClose:()=>L(null),onConfirm:er,folderName:(null==$?void 0:$.name)||"",projectCount:(null==$?void 0:$.projectCount)||0})]})})]})})}},6142:(e,r,l)=>{Promise.resolve().then(l.bind(l,2388))}},e=>{e.O(0,[685,534,721,659,948,986,143,358],()=>e(e.s=6142)),_N_E=e.O()}]);
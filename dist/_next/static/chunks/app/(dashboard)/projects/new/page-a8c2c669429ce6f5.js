(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[244],{626:(t,e,a)=>{"use strict";async function i(){return window.quick?window.quick:new Promise(t=>{let e=()=>{window.quick?t(window.quick):setTimeout(e,100)};e()})}a.d(e,{yv:()=>i})},747:(t,e,a)=>{Promise.resolve().then(a.bind(a,1282))},1282:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>f});var i=a(8045),n=a(5070),r=a(5177),c=a(7651),o=a(6198),l=a(3283);let s=t=>crypto.getRandomValues(new Uint8Array(t)),d=((t,e=21)=>((t,e,a)=>{let i=(2<<Math.log2(t.length-1))-1,n=-~(1.6*i*e/t.length);return (r=e)=>{let c="";for(;;){let e=a(n),o=0|n;for(;o--;)if((c+=t[e[o]&i]||"").length>=r)return c}}})(t,0|e,s))("0123456789abcdefghijklmnopqrstuvwxyz",12);function u(){let t=(0,n.useRouter)(),e=(0,n.useSearchParams)(),{user:a}=(0,o.A)(),s=(0,r.useRef)(!1),u=e.get("folder");return(0,r.useEffect)(()=>{!async function(){if(!s.current&&(null==a?void 0:a.email)){s.current=!0;try{let e="Untitled Project",i=await (0,l.JQ)(a.email);if(i.length>0){let t=i.filter(t=>t.name.startsWith("Untitled Project"));t.length>0&&(e="Untitled Project ".concat(t.length+1))}let n=d(),r=await (0,l.gA)({name:e,creator_id:a.email,share_token:n,folder_id:u||null});c.oR.success('Created "'.concat(r.name,'"')),t.push("/p?token=".concat(r.share_token))}catch(e){c.oR.error("Failed to create project. Please try again."),console.error("Failed to create project:",e),t.push("/projects")}}}()},[t,a,u]),(0,i.jsx)("main",{className:"h-screen flex items-center justify-center bg-[var(--color-background-primary)] text-[var(--color-text-primary)]",children:(0,i.jsxs)("div",{className:"text-center space-y-4",children:[(0,i.jsx)("div",{className:"text-lg font-medium",children:"Creating your project..."}),(0,i.jsx)("div",{className:"w-8 h-8 border-2 border-white/20 border-t-white rounded-full animate-spin mx-auto"})]})})}function f(){return(0,i.jsx)(r.Suspense,{fallback:null,children:(0,i.jsx)(u,{})})}},3283:(t,e,a)=>{"use strict";a.d(e,{Br:()=>g,CM:()=>h,Db:()=>f,Dg:()=>m,E0:()=>b,JQ:()=>n,L1:()=>r,Qg:()=>j,X5:()=>s,X7:()=>k,XA:()=>u,a3:()=>d,ct:()=>y,eP:()=>_,gA:()=>c,oZ:()=>w,updateProject:()=>o,wp:()=>v,xx:()=>l,yg:()=>p});var i=a(626);async function n(t){let e=(await (0,i.yv)()).db.collection("projects"),a=await e.find();return t&&(a=a.filter(e=>e.creator_id===t)),a.sort((t,e)=>{let a=t.last_accessed_at||t.created_at;return new Date(e.last_accessed_at||e.created_at).getTime()-new Date(a).getTime()})}async function r(t){let e=(await (0,i.yv)()).db.collection("projects");return(await e.find()).find(e=>e.share_token===t)||null}async function c(t){let e=(await (0,i.yv)()).db.collection("projects"),a={name:t.name,creator_id:t.creator_id,share_token:t.share_token,folder_id:t.folder_id||null,settings:t.settings||{default_columns:3,allow_viewer_control:!0,background_color:"#ffffff"}},n=await e.create(a);return await d({project_id:n.id,name:"Page 01",position:0}),n}async function o(t,e){let a=(await (0,i.yv)()).db.collection("projects");return await a.update(t,e),await a.findById(t)}async function l(t){let e=await (0,i.yv)(),a=await p(t);await Promise.all(a.map(t=>h(t.id)));let n=await s(t);await Promise.all(n.map(t=>f(t.id)));let r=e.db.collection("projects");await r.delete(t)}async function s(t){let e=(await (0,i.yv)()).db.collection("pages");return(await e.find()).filter(e=>e.project_id===t).sort((t,e)=>t.position-e.position)}async function d(t){let e=(await (0,i.yv)()).db.collection("pages");return await e.create(t)}async function u(t,e){let a=(await (0,i.yv)()).db.collection("pages");return await a.update(t,e),await a.findById(t)}async function f(t){let e=await (0,i.yv)(),a=await y(t);await Promise.all(a.map(t=>h(t.id)));let n=e.db.collection("pages");await n.delete(t)}async function w(t){let e=(await (0,i.yv)()).db.collection("pages");await Promise.all(t.map(t=>{let{id:a,position:i}=t;return e.update(a,{position:i})}))}async function p(t){let e=(await (0,i.yv)()).db.collection("artifacts");return(await e.find()).filter(e=>e.project_id===t).sort((t,e)=>t.position-e.position)}async function y(t){let e=(await (0,i.yv)()).db.collection("artifacts");return(await e.find()).filter(e=>e.page_id===t).sort((t,e)=>t.position-e.position)}async function m(t){let e=(await (0,i.yv)()).db.collection("artifacts"),a={project_id:t.project_id,page_id:t.page_id,type:t.type,source_url:t.source_url,file_path:t.file_path||null,name:t.name,position:t.position,metadata:t.metadata||{}};return await e.create(a)}async function _(t,e){let a=(await (0,i.yv)()).db.collection("artifacts");return await a.update(t,e),await a.findById(t)}async function h(t){let e=(await (0,i.yv)()).db.collection("artifacts");await e.delete(t)}async function g(t){let e=(await (0,i.yv)()).db.collection("artifacts");await Promise.all(t.map(t=>{let{id:a,position:i}=t;return e.update(a,{position:i})}))}async function v(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"editor",n=(await (0,i.yv)()).db.collection("project_access"),r=(await n.find()).find(a=>a.project_id===t&&a.user_email===e);r?await n.update(r.id,{role:a}):await n.create({project_id:t,user_email:e,role:a})}async function b(t,e){let a=(await (0,i.yv)()).db.collection("project_access"),n=(await a.find()).find(a=>a.project_id===t&&a.user_email===e);n&&await a.delete(n.id)}async function j(t){let e=(await (0,i.yv)()).db.collection("project_access");return(await e.find()).filter(e=>e.project_id===t)}async function k(t,e,a){let n=(await (0,i.yv)()).db.collection(t),r=(await n.find()).filter(t=>t[a]===e);return 0===r.length?0:Math.max(...r.map(t=>t.position||0))+1}},6198:(t,e,a)=>{"use strict";a.d(e,{A:()=>l,AuthProvider:()=>o});var i=a(8045),n=a(5177),r=a(626);let c=(0,n.createContext)(void 0);function o(t){let{children:e}=t,[a,o]=(0,n.useState)(null),[l,s]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let t=!0;return async function(){try{let e=await (0,r.yv)(),a=await e.id.waitForUser();console.log("Quick user loaded:",a),t&&(o({email:a.email,fullName:a.fullName,firstName:a.firstName,slackHandle:a.slackHandle,slackId:a.slackId,slackImageUrl:a.slackImageUrl,title:a.title,github:a.github}),s(!1))}catch(e){console.error("Failed to load Quick user:",e),t&&s(!1)}}(),()=>{t=!1}},[]),(0,i.jsx)(c.Provider,{value:{user:a,loading:l,isAuthenticated:!!a,signIn:async()=>{window.location.reload()},signOut:async()=>{console.warn("Sign out is handled by Quick platform - redirect to logout if needed")}},children:e})}function l(){let t=(0,n.useContext)(c);if(!t)throw Error("useAuth must be used within an AuthProvider");return t}}},t=>{t.O(0,[534,986,143,358],()=>t(t.s=747)),_N_E=t.O()}]);
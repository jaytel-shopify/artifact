(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[244],{626:(t,e,a)=>{"use strict";async function i(){return window.quick?window.quick:new Promise(t=>{let e=()=>{window.quick?t(window.quick):setTimeout(e,100)};e()})}a.d(e,{yv:()=>i})},747:(t,e,a)=>{Promise.resolve().then(a.bind(a,1282))},1282:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>d});var i=a(8045),n=a(5070),r=a(5177),o=a(7651),c=a(6198),l=a(3283);let s=t=>crypto.getRandomValues(new Uint8Array(t)),u=((t,e=21)=>((t,e,a)=>{let i=(2<<Math.log2(t.length-1))-1,n=-~(1.6*i*e/t.length);return (r=e)=>{let o="";for(;;){let e=a(n),c=0|n;for(;c--;)if((o+=t[e[c]&i]||"").length>=r)return o}}})(t,0|e,s))("0123456789abcdefghijklmnopqrstuvwxyz",12);function d(){let t=(0,n.useRouter)(),{user:e}=(0,c.A)(),a=(0,r.useRef)(!1);return(0,r.useEffect)(()=>{!async function(){if(!a.current&&(null==e?void 0:e.email)){a.current=!0;try{let a="Untitled Project",i=await (0,l.JQ)(e.email);if(i.length>0){let t=i.filter(t=>t.name.startsWith("Untitled Project"));t.length>0&&(a="Untitled Project ".concat(t.length+1))}let n=u(),r=await (0,l.gA)({name:a,creator_id:e.email,share_token:n});o.oR.success('Created "'.concat(r.name,'"')),t.push("/p?token=".concat(r.share_token))}catch(e){o.oR.error("Failed to create project. Please try again."),console.error("Failed to create project:",e),t.push("/projects")}}}()},[t,e]),(0,i.jsx)("main",{className:"h-screen flex items-center justify-center bg-[var(--color-background-primary)] text-[var(--color-text-primary)]",children:(0,i.jsxs)("div",{className:"text-center space-y-4",children:[(0,i.jsx)("div",{className:"text-lg font-medium",children:"Creating your project..."}),(0,i.jsx)("div",{className:"w-8 h-8 border-2 border-white/20 border-t-white rounded-full animate-spin mx-auto"})]})})}},3283:(t,e,a)=>{"use strict";a.d(e,{Br:()=>v,CM:()=>g,Db:()=>f,Dg:()=>m,JQ:()=>n,L1:()=>r,X5:()=>s,X7:()=>_,XA:()=>d,a3:()=>u,ct:()=>y,eP:()=>h,gA:()=>o,oZ:()=>w,vr:()=>c,xx:()=>l,yg:()=>p});var i=a(626);async function n(t){let e=(await (0,i.yv)()).db.collection("projects"),a=await e.find();return t&&(a=a.filter(e=>e.creator_id===t)),a.sort((t,e)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime())}async function r(t){let e=(await (0,i.yv)()).db.collection("projects");return(await e.find()).find(e=>e.share_token===t)||null}async function o(t){let e=(await (0,i.yv)()).db.collection("projects"),a={name:t.name,creator_id:t.creator_id,share_token:t.share_token,settings:t.settings||{default_columns:3,allow_viewer_control:!0,background_color:"#ffffff"}},n=await e.create(a);return await u({project_id:n.id,name:"Page 01",position:0}),n}async function c(t,e){let a=(await (0,i.yv)()).db.collection("projects");return await a.update(t,e),await a.findById(t)}async function l(t){let e=await (0,i.yv)(),a=await p(t);await Promise.all(a.map(t=>g(t.id)));let n=await s(t);await Promise.all(n.map(t=>f(t.id)));let r=e.db.collection("projects");await r.delete(t)}async function s(t){let e=(await (0,i.yv)()).db.collection("pages");return(await e.find()).filter(e=>e.project_id===t).sort((t,e)=>t.position-e.position)}async function u(t){let e=(await (0,i.yv)()).db.collection("pages");return await e.create(t)}async function d(t,e){let a=(await (0,i.yv)()).db.collection("pages");return await a.update(t,e),await a.findById(t)}async function f(t){let e=await (0,i.yv)(),a=await y(t);await Promise.all(a.map(t=>g(t.id)));let n=e.db.collection("pages");await n.delete(t)}async function w(t){let e=(await (0,i.yv)()).db.collection("pages");await Promise.all(t.map(t=>{let{id:a,position:i}=t;return e.update(a,{position:i})}))}async function p(t){let e=(await (0,i.yv)()).db.collection("artifacts");return(await e.find()).filter(e=>e.project_id===t).sort((t,e)=>t.position-e.position)}async function y(t){let e=(await (0,i.yv)()).db.collection("artifacts");return(await e.find()).filter(e=>e.page_id===t).sort((t,e)=>t.position-e.position)}async function m(t){let e=(await (0,i.yv)()).db.collection("artifacts"),a={project_id:t.project_id,page_id:t.page_id,type:t.type,source_url:t.source_url,file_path:t.file_path||null,name:t.name,position:t.position,metadata:t.metadata||{}};return await e.create(a)}async function h(t,e){let a=(await (0,i.yv)()).db.collection("artifacts");return await a.update(t,e),await a.findById(t)}async function g(t){let e=(await (0,i.yv)()).db.collection("artifacts");await e.delete(t)}async function v(t){let e=(await (0,i.yv)()).db.collection("artifacts");await Promise.all(t.map(t=>{let{id:a,position:i}=t;return e.update(a,{position:i})}))}async function _(t,e,a){let n=(await (0,i.yv)()).db.collection(t),r=(await n.find()).filter(t=>t[a]===e);return 0===r.length?0:Math.max(...r.map(t=>t.position||0))+1}},5070:(t,e,a)=>{"use strict";var i=a(418);a.o(i,"useRouter")&&a.d(e,{useRouter:function(){return i.useRouter}}),a.o(i,"useSearchParams")&&a.d(e,{useSearchParams:function(){return i.useSearchParams}})},6198:(t,e,a)=>{"use strict";a.d(e,{A:()=>l,AuthProvider:()=>c});var i=a(8045),n=a(5177),r=a(626);let o=(0,n.createContext)(void 0);function c(t){let{children:e}=t,[a,c]=(0,n.useState)(null),[l,s]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let t=!0;return async function(){try{let e=await (0,r.yv)(),a=await e.id.waitForUser();console.log("Quick user loaded:",a),t&&(c({email:a.email,fullName:a.fullName,firstName:a.firstName,slackHandle:a.slackHandle,slackId:a.slackId,slackImageUrl:a.slackImageUrl,title:a.title,github:a.github}),s(!1))}catch(e){console.error("Failed to load Quick user:",e),t&&s(!1)}}(),()=>{t=!1}},[]),(0,i.jsx)(o.Provider,{value:{user:a,loading:l,isAuthenticated:!!a,signIn:async()=>{window.location.reload()},signOut:async()=>{console.warn("Sign out is handled by Quick platform - redirect to logout if needed")}},children:e})}function l(){let t=(0,n.useContext)(o);if(!t)throw Error("useAuth must be used within an AuthProvider");return t}}},t=>{t.O(0,[651,986,143,358],()=>t(t.s=747)),_N_E=t.O()}]);
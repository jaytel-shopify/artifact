(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[707],{3663:(e,r,o)=>{"use strict";o.r(r),o.d(r,{default:()=>R});var t=o(8045),n=o(5177),l=o(5070),a=o(6198),s=o(6436),i=o(6796),c=o(7023),d=o(5993),u=o(9155),m=o(3173),h=o(3815),j=o(6115),f=o(9444),p=o(2402),x=o(6611),v=o(7651),y=o(8533),k=o(786),C=o(3283);function g(){let e=(0,l.useSearchParams)().get("id")||"",r=(0,l.useRouter)(),{user:g}=(0,a.A)(),[R,w]=(0,n.useState)(null),[F,P]=(0,n.useState)([]),[S,N]=(0,n.useState)(!1),[_,E]=(0,n.useState)(!0),[b,A]=(0,n.useState)(!1),[D,O]=(0,n.useState)(!1),[I,T]=(0,n.useState)(!1),[$,L]=(0,n.useState)(!1),[z,H]=(0,n.useState)(null),[q,B]=(0,n.useState)(!1),[G,K]=(0,n.useState)(null),[U,Z]=(0,n.useState)("");async function J(e){if(R)try{await (0,k.updateFolder)(R.id,{name:e}),w({...R,name:e}),v.oR.success("Folder renamed")}catch(e){throw console.error("Failed to rename folder:",e),v.oR.error("Failed to rename folder"),e}}async function M(){if(R)try{await (0,k.sE)(R.id),v.oR.success('Folder "'.concat(R.name,'" and all its projects deleted')),r.push("/projects")}catch(e){throw console.error("Failed to delete folder:",e),v.oR.error("Failed to delete folder"),e}}async function Q(){r.push("/projects/new?folder=".concat(e))}(0,n.useEffect)(()=>{!async function(){if((null==g?void 0:g.email)&&e)try{let[o,t,n]=await Promise.all([(0,k.dz)(e),(0,k.tq)(e,g.email),(0,k.mT)(e)]);if(!o){v.oR.error("Folder not found"),r.push("/projects");return}w(o),N(t),t&&(0,k.updateFolder)(e,{last_accessed_at:new Date().toISOString()}).catch(console.error);let l=await Promise.all(n.map(async e=>{let r=await (0,C.yg)(e.id);return{...e,coverArtifacts:r.slice(0,3)}}));P(l)}catch(e){console.error("Failed to load folder:",e),v.oR.error("Failed to load folder")}finally{E(!1)}}()},[e,g,r]);function V(e){K(e),Z(e.name)}async function W(){if(z){L(!0);try{await (0,C.xx)(z.id),P(e=>e.filter(e=>e.id!==z.id)),v.oR.success('Project "'.concat(z.name,'" deleted successfully')),H(null)}catch(e){v.oR.error("Failed to delete project. Please try again."),console.error("Error deleting project:",e)}finally{L(!1)}}}async function X(){if(G&&U.trim()){B(!0);try{await (0,C.updateProject)(G.id,{name:U.trim()}),P(e=>e.map(e=>e.id===G.id?{...e,name:U.trim()}:e)),v.oR.success('Project renamed to "'.concat(U.trim(),'"')),K(null),Z("")}catch(e){v.oR.error("Failed to rename project. Please try again."),console.error("Error renaming project:",e)}finally{B(!1)}}}if(_||!R)return null;async function Y(e){R&&w({...R,name:e})}return(0,t.jsx)(y.A,{isLoading:!1,children:(0,t.jsxs)(j.A,{mode:"folder",folderId:R.id,folderName:R.name,onBackToHome:function(){r.push("/projects")},onFolderNameUpdate:S?Y:void 0,onFolderShare:()=>O(!0),onFolderRename:()=>A(!0),onFolderDelete:()=>T(!0),onNewProject:S?Q:void 0,children:[(0,t.jsx)("div",{className:"max-w-7xl mx-auto p-6",children:0===F.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"No projects in this folder yet"}),S&&(0,t.jsx)(u.$,{onClick:Q,children:"Create Project in Folder"})]}):(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:F.map(e=>(0,t.jsxs)(s.tz,{children:[(0,t.jsx)(s.Rc,{asChild:!0,children:(0,t.jsx)("div",{children:(0,t.jsx)(h.A,{project:e,onClick:()=>{r.push("/p?token=".concat(e.share_token))},onHover:()=>{r.prefetch("/p?token=".concat(e.share_token))},onDelete:()=>{H(e)},menuItems:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i._2,{onClick:()=>V(e),children:"Rename Project"}),(0,t.jsx)(i._2,{onClick:async()=>{try{let{removeProjectFromFolder:r}=await Promise.resolve().then(o.bind(o,786));await r(e.id),P(r=>r.filter(r=>r.id!==e.id)),v.oR.success("Project moved to main Projects")}catch(e){v.oR.error("Failed to move project")}},children:"Remove from Folder"}),(0,t.jsx)(i._2,{variant:"destructive",onClick:()=>{H(e)},children:"Delete Project"})]})})})}),(0,t.jsxs)(s.Ip,{children:[(0,t.jsx)(s.kt,{onClick:()=>V(e),children:"Rename Project"}),(0,t.jsx)(s.kt,{onClick:async()=>{try{let{removeProjectFromFolder:r}=await Promise.resolve().then(o.bind(o,786));await r(e.id),P(r=>r.filter(r=>r.id!==e.id)),v.oR.success("Project moved to main Projects")}catch(e){v.oR.error("Failed to move project")}},children:"Remove from Folder"}),(0,t.jsx)(s.kt,{variant:"destructive",onClick:()=>{H(e)},children:"Delete Project"})]})]},e.id))})}),(0,t.jsx)(f.A,{isOpen:b,onClose:()=>A(!1),onSubmit:J,mode:"rename",initialName:R.name}),(0,t.jsx)(p.A,{isOpen:D,onClose:()=>O(!1),folderId:R.id,folderName:R.name,creatorEmail:R.creator_id}),(0,t.jsx)(x.A,{isOpen:I,onClose:()=>T(!1),onConfirm:M,folderName:R.name,projectCount:F.length}),(0,t.jsx)(d.Lt,{open:!!z,onOpenChange:e=>!e&&H(null),children:(0,t.jsxs)(d.EO,{children:[(0,t.jsxs)(d.wd,{children:[(0,t.jsx)(d.r7,{children:"Delete Project"}),(0,t.jsxs)(d.$v,{children:["Are you sure you want to delete “",null==z?void 0:z.name,"”? This will permanently delete the project and all its pages and artifacts. This action cannot be undone."]})]}),(0,t.jsxs)(d.ck,{children:[(0,t.jsx)(d.Zr,{children:"Cancel"}),(0,t.jsx)(d.Rx,{className:(0,u.r)({variant:"destructive"}),onClick:W,disabled:$,children:$?"Deleting...":"Delete"})]})]})}),(0,t.jsx)(c.lG,{open:!!G,onOpenChange:e=>!e&&K(null),children:(0,t.jsxs)(c.Cf,{children:[(0,t.jsxs)(c.c7,{children:[(0,t.jsx)(c.L3,{children:"Rename Project"}),(0,t.jsxs)(c.rr,{children:["Enter a new name for “",null==G?void 0:G.name,"”"]})]}),(0,t.jsx)("div",{className:"py-4",children:(0,t.jsx)(m.p,{value:U,onChange:e=>Z(e.target.value),placeholder:"Project name",onKeyDown:e=>{"Enter"===e.key&&U.trim()&&X()},autoFocus:!0})}),(0,t.jsxs)(c.Es,{children:[(0,t.jsx)(u.$,{variant:"outline",onClick:()=>K(null),children:"Cancel"}),(0,t.jsx)(u.$,{onClick:X,disabled:q||!U.trim(),children:q?"Renaming...":"Rename"})]})]})})]})})}function R(){return(0,t.jsx)(n.Suspense,{fallback:null,children:(0,t.jsx)(g,{})})}},9902:(e,r,o)=>{Promise.resolve().then(o.bind(o,3663))}},e=>{e.O(0,[685,534,721,576,659,115,429,986,143,358],()=>e(e.s=9902)),_N_E=e.O()}]);
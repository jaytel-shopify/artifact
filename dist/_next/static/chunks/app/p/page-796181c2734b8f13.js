(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[829],{228:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>k});var a=r(8045),n=r(3842),l=r(5177),o=r(4020),s=r.n(o),i=r(5070);function c(e){let{onFiles:t,onUrl:r,onDragStateChange:n}=e,[o,s]=(0,l.useState)(!1),i=(0,l.useRef)(0),c=(0,l.useCallback)(e=>{s(e),null==n||n(e)},[n]);return(0,l.useEffect)(()=>{function e(e){var t,r;let a=Array.from(null!=(r=null==(t=e.dataTransfer)?void 0:t.types)?r:[]);return a.includes("Files")||a.includes("text/uri-list")||a.includes("text/plain")}function a(t){e(t)&&(i.current+=1,c(!0))}function n(t){e(t)&&t.preventDefault()}function l(t){e(t)&&(i.current=Math.max(0,i.current-1),0===i.current&&c(!1))}async function o(a){var n,l,o,s;if(!e(a))return;a.preventDefault(),i.current=0,c(!1);let d=Array.from(null!=(s=null==(n=a.dataTransfer)?void 0:n.files)?s:[]);if(d.length)return void await t(d);let u=(null==(l=a.dataTransfer)?void 0:l.getData("text/uri-list"))||(null==(o=a.dataTransfer)?void 0:o.getData("text/plain"));u&&r&&await r(u.trim())}return window.addEventListener("dragenter",a),window.addEventListener("dragover",n),window.addEventListener("dragleave",l),window.addEventListener("drop",o),()=>{window.removeEventListener("dragenter",a),window.removeEventListener("dragover",n),window.removeEventListener("dragleave",l),window.removeEventListener("drop",o)}},[t,r,c]),(0,a.jsx)("div",{className:"absolute inset-0 z-10",style:{pointerEvents:o?"auto":"none"},children:o&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60 backdrop-blur-lg text-white/90 pointer-events-none",children:(0,a.jsxs)("div",{className:"text-center space-y-3 w-full max-w-xs px-6",children:[(0,a.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-white/10 border border-white/20",children:(0,a.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",className:"h-6 w-6 text-white/90",children:[(0,a.jsx)("path",{d:"M12 16v-8m0 0 3 3m-3-3-3 3",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"}),(0,a.jsx)("path",{d:"M6 17.5V18a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-.5",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,a.jsx)("div",{className:"text-sm font-medium",children:"Drop to upload your artifacts"}),(0,a.jsx)("div",{className:"text-xs text-white/70",children:"Images, videos, or PDFs up to 20MB each"}),(0,a.jsx)("div",{className:"h-1 w-full overflow-hidden rounded-full bg-white/10",children:(0,a.jsx)("div",{className:"h-full w-full animate-[progress_1.2s_linear_infinite] bg-white/70"})})]})})})}var d=r(2230),u=r(3173),f=r(6436),g=r(7651);function m(e){let{isOpen:t,pages:r,currentPageId:n,onPageSelect:o,onPageRename:s,onPageCreate:i,onPageDelete:c}=e,[d,m]=(0,l.useState)(null),[p,v]=(0,l.useState)(""),[h,x]=(0,l.useState)(!1),y=e=>{m(e.id),v(e.name)},b=async e=>{if(p.trim()&&s){x(!0);try{await s(e,p.trim()),m(null),v(""),g.oR.success("Page renamed successfully")}catch(e){g.oR.error("Failed to rename page. Please try again."),console.error("Failed to rename page:",e)}finally{x(!1)}}};return(0,a.jsx)("aside",{className:"bg-[var(--color-background-primary)] border-r border-[var(--color-border-primary)] h-full flex-shrink-0",style:{width:"var(--sidebar-width)"},children:(0,a.jsxs)("div",{className:"flex flex-col h-full p-[var(--spacing-2xl)]",children:[(0,a.jsx)("div",{className:"flex-1 space-y-0 overflow-y-auto",children:0===r.length?(0,a.jsx)("div",{className:"text-[var(--color-text-secondary)] text-center py-[var(--spacing-xl)]",style:{fontSize:"var(--font-size-sm)"},children:"No pages yet"}):r.map(e=>(0,a.jsx)("div",{children:d===e.id?(0,a.jsx)("div",{className:"flex items-center p-[var(--spacing-sm)] rounded-[var(--radius-md)]",children:(0,a.jsx)(u.p,{type:"text",value:p,onChange:e=>v(e.target.value),onBlur:()=>!h&&b(e.id),onKeyDown:t=>{"Enter"===t.key&&b(e.id),"Escape"===t.key&&(m(null),v(""))},className:"flex-1 bg-[var(--color-background-secondary)] text-[var(--color-text-primary)] border-[var(--color-border-secondary)] focus:border-[var(--color-accent-primary)] focus:ring-[var(--color-accent-primary)]/20",style:{fontSize:"var(--font-size-sm)"},disabled:h,autoFocus:!0})}):(0,a.jsxs)(f.tz,{children:[(0,a.jsx)(f.Rc,{asChild:!0,children:(0,a.jsx)("div",{className:"flex items-center p-[var(--spacing-sm)] rounded-[var(--radius-md)] cursor-pointer transition-all ".concat(n===e.id?"bg-[var(--color-background-tertiary)]":"hover:bg-[var(--color-background-secondary)] opacity-50 hover:opacity-100"),onClick:()=>null==o?void 0:o(e.id),children:(0,a.jsx)("span",{className:"text-[var(--color-text-primary)] font-[var(--font-weight-normal)] flex-1",style:{fontSize:"var(--font-size-sm)"},onDoubleClick:t=>{t.stopPropagation(),y(e)},children:e.name})})}),(0,a.jsxs)(f.Ip,{children:[(0,a.jsx)(f.kt,{onClick:()=>y(e),children:"Rename"}),r.length>1&&(0,a.jsx)(f.kt,{variant:"destructive",onClick:()=>(e=>{if(r.length<=1)return void g.oR.error("Cannot delete the last page");null==c||c(e),g.oR.success("Page deleted successfully")})(e.id),children:"Delete"})]})]})},e.id))}),(0,a.jsx)("div",{className:"pt-[var(--spacing-lg)] border-t border-[var(--color-border-primary)] mt-[var(--spacing-lg)]",children:(0,a.jsxs)("button",{onClick:i,className:"flex items-center gap-[var(--spacing-sm)] w-full p-[var(--spacing-sm)] rounded-[var(--radius-md)] text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)] hover:bg-[var(--color-background-secondary)] transition-all cursor-pointer",style:{fontSize:"var(--font-size-sm)"},children:[(0,a.jsx)("span",{className:"text-lg",children:"+"}),(0,a.jsx)("span",{children:"New Page"})]})})]})})}function p(e){let{children:t,mode:r,projectId:n,projectName:o,onProjectNameUpdate:s,onArtifactAdded:i,columns:c,onColumnsChange:u,showColumnControls:f,pages:g,currentPageId:p,onPageSelect:v,onPageRename:h,onPageCreate:x,onPageDelete:y,onBackToHome:b}=e,[w,j]=(0,l.useState)(!1),[P,k]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=window.localStorage.getItem("sidebar_open");null!==e&&j(JSON.parse(e)),k(!0)},[]),(0,l.useEffect)(()=>{P&&window.localStorage.setItem("sidebar_open",JSON.stringify(w))},[w,P]),(0,a.jsxs)("div",{className:"h-screen flex flex-col bg-[var(--color-background-primary)] text-[var(--color-text-primary)]",style:{fontFamily:"var(--font-family-primary)"},children:[(0,a.jsx)(d.A,{mode:r,onBackToHome:b,onToggleSidebar:()=>{j(e=>!e)},sidebarOpen:w,projectId:n,projectName:o,onProjectNameUpdate:s,onArtifactAdded:i,currentPageId:p,columns:c,onColumnsChange:u,showColumnControls:f}),(0,a.jsxs)("div",{className:"flex flex-1 min-h-0 relative",children:["canvas"===r&&w&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 z-[5] lg:hidden animate-in fade-in duration-300",style:{animationTimingFunction:"var(--spring-elegant-easing-light)"},onClick:()=>j(!1)}),"canvas"===r&&(0,a.jsx)("div",{className:"absolute top-0 left-0 h-full z-10 ".concat(w?"translate-x-0":"-translate-x-full"),style:{transition:"transform 400ms var(--spring-elegant-easing-light)"},children:(0,a.jsx)(m,{isOpen:!0,pages:g||[],currentPageId:p,onPageSelect:v,onPageRename:h,onPageCreate:x,onPageDelete:y})}),(0,a.jsx)("main",{className:"flex-1 min-w-0",style:{marginLeft:"canvas"===r&&w?"var(--sidebar-width)":"0",transition:"margin-left 400ms var(--spring-elegant-easing-light)"},children:t})]})]})}var v=r(3283);async function h(e){return await (0,v.X5)(e)}var x=r(1905),y=r(6835),b=r(8998);let w=s()(()=>Promise.all([r.e(627),r.e(240)]).then(r.bind(r,7859)),{loadableGenerated:{webpack:()=>[7859]},ssr:!1});async function j(e){return await (0,v.L1)(e)}function P(){let e=(0,i.useSearchParams)().get("token")||"",t=(0,i.useRouter)(),[r,o]=(0,l.useState)(3),[s,d]=(0,l.useState)(!1),[u,f]=(0,l.useTransition)(),[m,P]=(0,l.useState)(!1),[k,N]=(0,l.useState)({uploading:!1,totalFiles:0,completedFiles:0,currentProgress:0});(0,l.useEffect)(()=>{let e=window.localStorage.getItem("columns_in_view");e&&o(Math.min(8,Math.max(1,Number(e)))),P(!0)},[]),(0,l.useEffect)(()=>{m&&window.localStorage.setItem("columns_in_view",String(r))},[r,m]);let{data:S}=(0,n.Ay)(e?"project-token-".concat(e):null,()=>e?j(e):null,{revalidateOnFocus:!1}),{pages:_,createPage:C,updatePage:F,deletePage:R}=function(e){let{data:t=[],error:r,isLoading:a,mutate:o}=(0,n.Ay)(e?"pages-".concat(e):null,()=>e?h(e):[],{revalidateOnFocus:!1}),s=(0,l.useCallback)(async t=>{if(!e)return null;try{let r=await (0,v.X7)("pages",e,"project_id"),a=await (0,v.a3)({project_id:e,name:t,position:r});return await o(),a}catch(e){throw console.error("Failed to create page:",e),e}},[e,o]),i=(0,l.useCallback)(async(t,r)=>{if(!e)return null;try{let e=await (0,v.XA)(t,r);return await o(),e}catch(e){throw console.error("Failed to update page:",e),e}},[e,o]);return{pages:t,isLoading:a,error:r,createPage:s,updatePage:i,deletePage:(0,l.useCallback)(async t=>{if(e)try{await (0,v.Db)(t),await o()}catch(e){throw console.error("Failed to delete page:",e),e}},[e,o]),reorderPages:(0,l.useCallback)(async t=>{if(e){o(t,!1);try{let e=t.map((e,t)=>({id:e.id,position:t}));await (0,v.oZ)(e),await o()}catch(e){throw await o(),console.error("Failed to reorder pages:",e),e}}},[e,o]),refetch:o}}(null==S?void 0:S.id),{currentPageId:O,selectPage:E}=function(e,t){let[r,a]=(0,l.useState)(null);(0,l.useEffect)(()=>{e.length>0&&!r&&a((e.find(e=>0===e.position)||e[0]).id)},[e,r]);let n=e.find(e=>e.id===r)||e[0]||null;return{currentPageId:r,currentPage:n,selectPage:e=>{a(e)},selectNextPage:()=>{if(!n||e.length<=1)return;let t=(e.findIndex(e=>e.id===n.id)+1)%e.length;a(e[t].id)},selectPreviousPage:()=>{if(!n||e.length<=1)return;let t=e.findIndex(e=>e.id===n.id),r=0===t?e.length-1:t-1;a(e[r].id)}}}(_,null==S||S.id),{artifacts:L,createArtifact:A,reorderArtifacts:M,updateArtifact:D,deleteArtifact:z,refetch:I}=(0,x.C)(null==S?void 0:S.id,O||void 0);(0,l.useEffect)(()=>{(null==S?void 0:S.name)&&(document.title="".concat(S.name," | Artifact"))},[null==S?void 0:S.name]);let T=(0,l.useCallback)(async e=>{if((null==S?void 0:S.id)&&O&&0!==e.length){N({uploading:!0,totalFiles:e.length,completedFiles:0,currentProgress:0});try{let t=0;for(let r of e){let a=await (0,b.QM)(r,r=>{let a=r.percentage,n=Math.round((100*t+a)/e.length);N(e=>({...e,currentProgress:n}))}),n=(0,b.lu)(a.mimeType),l=(0,y.Rr)(n,a.fullUrl,r);await A({type:n,source_url:a.fullUrl,file_path:a.url,name:l}),t++,N(r=>({...r,completedFiles:t,currentProgress:Math.round(t/e.length*100)}))}g.oR.success("Successfully uploaded ".concat(e.length," file").concat(e.length>1?"s":"")),f(()=>{I()})}catch(e){g.oR.error("Failed to upload files. Please try again."),console.error(e)}finally{N({uploading:!1,totalFiles:0,completedFiles:0,currentProgress:0})}}},[null==S?void 0:S.id,O,A,I]),U=(0,l.useCallback)(async e=>{if((null==S?void 0:S.id)&&O){N({uploading:!0,totalFiles:1,completedFiles:0,currentProgress:50});try{let t=(0,y.Rr)("url",e);await A({type:"url",source_url:e,name:t}),N(e=>({...e,completedFiles:1,currentProgress:100})),g.oR.success("Successfully added URL artifact"),f(()=>{I()})}catch(e){g.oR.error("Failed to add URL artifact. Please try again."),console.error(e)}finally{N({uploading:!1,totalFiles:0,completedFiles:0,currentProgress:0})}}},[null==S?void 0:S.id,O,A,I]),B=(0,l.useCallback)(async()=>{try{let e=await C("Page ".concat(String(_.length+1).padStart(2,"0")));e&&E(e.id)}catch(e){g.oR.error("Failed to create page. Please try again."),console.error("Failed to create page:",e)}},[C,_.length,E]),X=(0,l.useCallback)(async e=>{try{await R(e)}catch(e){g.oR.error("Failed to delete page. Please try again."),console.error("Failed to delete page:",e)}},[R]),W=(0,l.useCallback)(async(e,t)=>{try{await F(e,{name:t})}catch(e){throw g.oR.error("Failed to rename page. Please try again."),console.error("Failed to rename page:",e),e}},[F]),G=(0,l.useCallback)(e=>{S&&(S.name=e)},[S]),H=(0,l.useCallback)(()=>{t.push("/projects")},[t]),J=k.uploading||u;return S&&0!==_.length?(0,a.jsx)(p,{mode:"canvas",projectId:S.id,projectName:S.name,onProjectNameUpdate:G,onArtifactAdded:I,columns:r,onColumnsChange:o,showColumnControls:!0,pages:_,currentPageId:O||void 0,onPageSelect:E,onPageRename:W,onPageCreate:B,onPageDelete:X,onBackToHome:H,children:(0,a.jsxs)("div",{className:"h-full relative",children:[(null==S?void 0:S.id)&&O&&(0,a.jsx)(c,{onFiles:T,onUrl:U,onDragStateChange:d}),(s||J)&&(0,a.jsx)("div",{className:"absolute inset-0 z-30 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:(0,a.jsx)("div",{className:"px-[var(--spacing-xl)] py-[var(--spacing-lg)] rounded-2xl bg-white/95 text-black shadow-xl",style:{fontSize:"var(--font-size-sm)"},children:s?(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("div",{className:"font-medium",children:"Drop to upload"})}):(0,a.jsxs)("div",{className:"text-center space-y-3 min-w-[200px]",children:[(0,a.jsxs)("div",{className:"font-medium",children:["Uploading",k.totalFiles>1?" ".concat(k.completedFiles+1," of ").concat(k.totalFiles):"","..."]}),k.uploading&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300 ease-out",style:{width:"".concat(k.currentProgress,"%")}})}),(0,a.jsxs)("div",{className:"text-xs text-gray-600",children:[k.currentProgress,"%"]})]})]})})}),(0,a.jsx)("div",{className:"h-full pt-[var(--spacing-xl)]",children:(0,a.jsx)(w,{columns:r,artifacts:L,onReorder:async e=>{try{await M(e)}catch(e){g.oR.error("Failed to reorder artifacts. Please try again."),console.error("Failed to reorder artifacts:",e)}},onUpdateArtifact:async(e,t)=>{await D(e,t)},onDeleteArtifact:async e=>{await z(e)}})})]})}):(0,a.jsx)("div",{className:"h-screen flex items-center justify-center bg-[var(--color-background-primary)] text-[var(--color-text-primary)]",children:(0,a.jsx)("div",{className:"text-sm",children:"Loading..."})})}function k(){return(0,a.jsx)(l.Suspense,{fallback:(0,a.jsx)("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}),children:(0,a.jsx)(P,{})})}},691:(e,t,r)=>{"use strict";function a(e){let{reason:t,children:r}=e;return r}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return a}}),r(967)},1438:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return a}});let a=(0,r(6576).createAsyncLocalStorage)()},3326:(e,t,r)=>{"use strict";function a(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return a}}),r(8045),r(4380),r(7269),r(7756)},4020:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});let a=r(6708)._(r(8436));function n(e,t){var r;let n={};"function"==typeof e&&(n.loader=e);let l={...n,...t};return(0,a.default)({...l,modules:null==(r=l.loadableGenerated)?void 0:r.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6576:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{bindSnapshot:function(){return o},createAsyncLocalStorage:function(){return l},createSnapshot:function(){return s}});let r=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class a{disable(){throw r}getStore(){}run(){throw r}exit(){throw r}enterWith(){throw r}static bind(e){return e}}let n="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function l(){return n?new n:new a}function o(e){return n?n.bind(e):a.bind(e)}function s(){return n?n.snapshot():function(e,...t){return e(...t)}}},7269:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return a.workAsyncStorageInstance}});let a=r(1438)},8306:(e,t,r)=>{Promise.resolve().then(r.bind(r,228))},8436:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});let a=r(8045),n=r(5177),l=r(691);function o(e){return{default:e&&"default"in e?e.default:e}}r(3326);let s={loader:()=>Promise.resolve(o(()=>null)),loading:null,ssr:!0},i=function(e){let t={...s,...e},r=(0,n.lazy)(()=>t.loader().then(o)),i=t.loading;function c(e){let o=i?(0,a.jsx)(i,{isLoading:!0,pastDelay:!0,error:null}):null,s=!t.ssr||!!t.loading,c=s?n.Suspense:n.Fragment,d=t.ssr?(0,a.jsxs)(a.Fragment,{children:[null,(0,a.jsx)(r,{...e})]}):(0,a.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,a.jsx)(r,{...e})});return(0,a.jsx)(c,{...s?{fallback:o}:{},children:d})}return c.displayName="LoadableComponent",c}}},e=>{e.O(0,[685,651,944,451,986,143,358],()=>e(e.s=8306)),_N_E=e.O()}]);